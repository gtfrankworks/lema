import{a as e,c as a,b as i,o as n}from"./app-ZQgO6-gU.js";const l={};function t(d,s){return n(),a("div",null,s[0]||(s[0]=[i(`<p>在 <a href="https://mybatis-flex.com/zh/base/add-delete-update.html" target="_blank" rel="noopener noreferrer">增删改</a> 和 <a href="https://mybatis-flex.com/zh/base/query.html" target="_blank" rel="noopener noreferrer">查询和分页</a> 章节中，我们随时能看到 QueryWrapper 的身影，QueryWrapper 是用于构造 Sql 的 强有力工具，也是 MyBatis-Flex 的亮点和特色。</p><p>提示</p><p>QueryWrapper 可以被序列化通过 RPC 进行传输，因此，在微服务项目中，我们可以在客户端（网关、Controller 层等）构造出 QueryWrapper，传给 Provider 层进行查询返回数据。</p><h2 id="querywrapper-的使用" tabindex="-1"><a class="header-anchor" href="#querywrapper-的使用"><span>QueryWrapper 的使用</span></a></h2><p>以下代码是一个完整 Spring Controller 的示例：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>@RestController</span></span>
<span class="line"><span>public class AccountController {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @Autowired</span></span>
<span class="line"><span>    AccountMapper accountMapper;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    @GetMapping(&quot;/accounts&quot;)</span></span>
<span class="line"><span>    List&lt;Account&gt; selectList() {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //构造 QueryWrapper，也支持使用 QueryWrapper.create() 构造，效果相同</span></span>
<span class="line"><span>        QueryWrapper query = new QueryWrapper();</span></span>
<span class="line"><span>        query.where(ACCOUNT.ID.ge(100));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //通过 query 查询数据列表返回</span></span>
<span class="line"><span>        return accountMapper.selectListByQuery(query);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在以上的示例中，其核心代码如下所示：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>//构造 QueryWrapper</span></span>
<span class="line"><span>QueryWrapper query = new QueryWrapper();</span></span>
<span class="line"><span>query.where(ACCOUNT.ID.ge(100));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//通过 query 查询数据列表</span></span>
<span class="line"><span>accountMapper.selectListByQuery(query);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上代码执行的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>select * from tb_account</span></span>
<span class="line"><span>where id &gt;= 100</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>问题：以上示例中，<code>ACCOUNT.ID.ge(100)</code> 中的 <code>ACCOUNT</code> 是怎么来的？</p><p>MyBatis-Flex 使用了 APT 技术，这个 <code>ACCOUNT</code> 是自动生成的。 参考：《<a href="https://mybatis-flex.com/zh/others/apt.html" target="_blank" rel="noopener noreferrer">MyBatis-Flex APT 配置</a>》章节。</p><h2 id="select" tabindex="-1"><a class="header-anchor" href="#select"><span>select *</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query1 = new QueryWrapper();</span></span>
<span class="line"><span>query1.select(ACCOUNT.ID, ACCOUNT.USER_NAME)</span></span>
<span class="line"><span>    .from(ACCOUNT);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>QueryWrapper query2 = new QueryWrapper();</span></span>
<span class="line"><span>query2.select().from(ACCOUNT);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT id, user_name FROM tb_account;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>SELECT * FROM tb_account;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="select-as" tabindex="-1"><a class="header-anchor" href="#select-as"><span>select ... as</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>    .select(</span></span>
<span class="line"><span>          ACCOUNT.ID.as(&quot;accountId&quot;)</span></span>
<span class="line"><span>        , ACCOUNT.USER_NAME)</span></span>
<span class="line"><span>    .from(ACCOUNT.as(&quot;a&quot;));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT a.id as accountId, a.user_name</span></span>
<span class="line"><span>FROM tb_account AS a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="select-多张表" tabindex="-1"><a class="header-anchor" href="#select-多张表"><span>select 多张表</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>    .select(</span></span>
<span class="line"><span>          ACCOUNT.ID</span></span>
<span class="line"><span>        , ACCOUNT.USER_NAME</span></span>
<span class="line"><span>        , ARTICLE.ID.as(&quot;articleId&quot;)</span></span>
<span class="line"><span>        , ARTICLE.TITLE)</span></span>
<span class="line"><span>    .from(ACCOUNT.as(&quot;a&quot;), ARTICLE.as(&quot;b&quot;))</span></span>
<span class="line"><span>    .where(ACCOUNT.ID.eq(ARTICLE.ACCOUNT_ID));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT a.id, a.user_name, b.id AS articleId, b.title</span></span>
<span class="line"><span>FROM tb_account AS a,</span></span>
<span class="line"><span>     tb_article AS b</span></span>
<span class="line"><span>WHERE a.id = b.account_id</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="select-function-sql-函数" tabindex="-1"><a class="header-anchor" href="#select-function-sql-函数"><span>select function（SQL 函数）</span></a></h2><p>所有函数均在 <code>QueryMethods</code> 类中，以下示例皆为静态导入方法，省略了类名。</p><p>示例 ：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>        .select(</span></span>
<span class="line"><span>            ACCOUNT.ID,</span></span>
<span class="line"><span>            ACCOUNT.USER_NAME,</span></span>
<span class="line"><span>            max(ACCOUNT.BIRTHDAY),</span></span>
<span class="line"><span>            avg(ACCOUNT.SEX).as(&quot;sex_avg&quot;)</span></span>
<span class="line"><span>        ).from(ACCOUNT);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT id, user_name, MAX(birthday), AVG(sex) AS sex_avg</span></span>
<span class="line"><span>FROM tb_account</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>在使用函数时，一些数字、字符串常量需要通过特定的方法去构造，例如：</p><ul><li>number()：构建数字常量</li><li>string()：构建字符串常量</li><li>column()：构建自定义列</li></ul><p>示例：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>select(number(1)) --&gt; SELECT 1</span></span>
<span class="line"><span>select(string(&quot;str&quot;)) --&gt; SELECT &#39;str&#39;</span></span>
<span class="line"><span>select(column(&quot;abc&quot;)) --&gt; SELECT abc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>目前，MyBatis-Flex 已支持 110+ 个常见的 SQL 函数，查看已支持的 <a href="https://gitee.com/mybatis-flex/mybatis-flex/blob/main/mybatis-flex-core/src/main//com/mybatisflex/core/constant/FuncName." target="_blank" rel="noopener noreferrer">所有函数</a>。 若还不满足，您可以参考 <a href="https://gitee.com/mybatis-flex/mybatis-flex/blob/main/mybatis-flex-core/src/main//com/mybatisflex/core/query/QueryMethods." target="_blank" rel="noopener noreferrer">QueryMethods</a> ，然后在自己的项目里进行自定义扩展。</p><table><thead><tr><th style="text-align:left;">支持的函数</th><th style="text-align:left;">函数说明</th></tr></thead><tbody><tr><td style="text-align:left;">count</td><td style="text-align:left;">查询数据总量</td></tr><tr><td style="text-align:left;">distinct</td><td style="text-align:left;">对指定列进行去重</td></tr><tr><td style="text-align:left;">sum</td><td style="text-align:left;">返回指定字段值的和</td></tr><tr><td style="text-align:left;">avg</td><td style="text-align:left;">返回指定列的平均值</td></tr><tr><td style="text-align:left;">min</td><td style="text-align:left;">返回指定列的最小值</td></tr><tr><td style="text-align:left;">max</td><td style="text-align:left;">返回指定列的最大值</td></tr><tr><td style="text-align:left;">abs</td><td style="text-align:left;">返回绝对值</td></tr><tr><td style="text-align:left;">ceil</td><td style="text-align:left;">返回大于或等于 x 的最小整数（向上取整）</td></tr><tr><td style="text-align:left;">ceiling</td><td style="text-align:left;">返回大于或等于 x 的最小整数（向上取整）</td></tr><tr><td style="text-align:left;">floor</td><td style="text-align:left;">返回小于或等于 x 的最大整数（向下取整）</td></tr><tr><td style="text-align:left;">rand</td><td style="text-align:left;">返回 0~1 的随机数</td></tr><tr><td style="text-align:left;">sign</td><td style="text-align:left;">返回 x 的符号，x 是负数、0、正数分别返回 -1、0、1</td></tr><tr><td style="text-align:left;">pi</td><td style="text-align:left;">返回圆周率</td></tr><tr><td style="text-align:left;">truncate</td><td style="text-align:left;">返回数值 x 保留到小数点后 y 位的值</td></tr><tr><td style="text-align:left;">round</td><td style="text-align:left;">返回离 x 最近的整数（四舍五入）</td></tr><tr><td style="text-align:left;">pow</td><td style="text-align:left;">返回 x 的 y 次方</td></tr><tr><td style="text-align:left;">power</td><td style="text-align:left;">返回 x 的 y 次方</td></tr><tr><td style="text-align:left;">sqrt</td><td style="text-align:left;">返回 x 的平方根</td></tr><tr><td style="text-align:left;">exp</td><td style="text-align:left;">返回 e 的 x 次方</td></tr><tr><td style="text-align:left;">mod</td><td style="text-align:left;">返回 x 除以 y 以后的余数</td></tr><tr><td style="text-align:left;">log</td><td style="text-align:left;">返回自然对数（以 e 为底的对数）</td></tr><tr><td style="text-align:left;">log10</td><td style="text-align:left;">返回以 10 为底的对数</td></tr><tr><td style="text-align:left;">radians</td><td style="text-align:left;">将角度转换为弧度</td></tr><tr><td style="text-align:left;">degrees</td><td style="text-align:left;">将弧度转换为角度</td></tr><tr><td style="text-align:left;">sin</td><td style="text-align:left;">求正弦值</td></tr><tr><td style="text-align:left;">asin</td><td style="text-align:left;">求反正弦值</td></tr><tr><td style="text-align:left;">cos</td><td style="text-align:left;">求余弦值</td></tr><tr><td style="text-align:left;">acos</td><td style="text-align:left;">求反余弦值</td></tr><tr><td style="text-align:left;">tan</td><td style="text-align:left;">求正切值</td></tr><tr><td style="text-align:left;">atan</td><td style="text-align:left;">求反正切值</td></tr><tr><td style="text-align:left;">cot</td><td style="text-align:left;">求余切值</td></tr><tr><td style="text-align:left;">charLength</td><td style="text-align:left;">返回字符串 s 的字符数</td></tr><tr><td style="text-align:left;">length</td><td style="text-align:left;">返回字符串 s 的长度</td></tr><tr><td style="text-align:left;">concat</td><td style="text-align:left;">将字符串 s1，s2 等多个字符串合并为一个字符串</td></tr><tr><td style="text-align:left;">concatWs</td><td style="text-align:left;">同 CONCAT(s1, s2, ...)，但是每个字符串之间要加上 x</td></tr><tr><td style="text-align:left;">insert</td><td style="text-align:left;">将字符串 s2 替换 s1 的 x 位置开始长度为 len 的字符串</td></tr><tr><td style="text-align:left;">upper</td><td style="text-align:left;">将字符串 s 的所有字符都变成大写字母</td></tr><tr><td style="text-align:left;">lower</td><td style="text-align:left;">将字符串 s 的所有字符都变成小写字母</td></tr><tr><td style="text-align:left;">left</td><td style="text-align:left;">返回字符串 s 的前 n 个字符</td></tr><tr><td style="text-align:left;">right</td><td style="text-align:left;">返回字符串 s 的后 n 个字符</td></tr><tr><td style="text-align:left;">lpad</td><td style="text-align:left;">字符串 s2 来填充 s1 的开始处，使字符串长度达到 len</td></tr><tr><td style="text-align:left;">rpad</td><td style="text-align:left;">字符串 s2 来填充 s1 的结尾处，使字符串长度达到 len</td></tr><tr><td style="text-align:left;">trim</td><td style="text-align:left;">去掉字符串 s 开始处和结尾处的空格</td></tr><tr><td style="text-align:left;">ltrim</td><td style="text-align:left;">去掉字符串 s 开始处的空格</td></tr><tr><td style="text-align:left;">rtrim</td><td style="text-align:left;">去掉字符串 s 结尾处的空格</td></tr><tr><td style="text-align:left;">repeat</td><td style="text-align:left;">将字符串 s 重复 n 次</td></tr><tr><td style="text-align:left;">space</td><td style="text-align:left;">返回 n 个空格</td></tr><tr><td style="text-align:left;">replace</td><td style="text-align:left;">用字符串 s2 代替字符串 s 中的字符串 s1</td></tr><tr><td style="text-align:left;">strcmp</td><td style="text-align:left;">比较字符串 s1 和 s2</td></tr><tr><td style="text-align:left;">substring</td><td style="text-align:left;">获取从字符串 s 中的第 n 个位置开始长度为 len 的字符串</td></tr><tr><td style="text-align:left;">instr</td><td style="text-align:left;">从字符串 s 中获取 s1 的开始位置</td></tr><tr><td style="text-align:left;">reverse</td><td style="text-align:left;">将字符串 s 的顺序反过来</td></tr><tr><td style="text-align:left;">elt</td><td style="text-align:left;">返回第 n 个字符串</td></tr><tr><td style="text-align:left;">field</td><td style="text-align:left;">返回第一个与字符串 s 匹配的字符串的位置</td></tr><tr><td style="text-align:left;">findInSet</td><td style="text-align:left;">返回在字符串 s2 中与 s1 匹配的字符串的位置</td></tr><tr><td style="text-align:left;">curDate</td><td style="text-align:left;">返回当前日期</td></tr><tr><td style="text-align:left;">currentDate</td><td style="text-align:left;">返回当前日期</td></tr><tr><td style="text-align:left;">curTime</td><td style="text-align:left;">返回当前时间</td></tr><tr><td style="text-align:left;">currentTime</td><td style="text-align:left;">返回当前时间</td></tr><tr><td style="text-align:left;">now</td><td style="text-align:left;">返回当前日期和时间</td></tr><tr><td style="text-align:left;">currentTimestamp</td><td style="text-align:left;">返回当前日期和时间</td></tr><tr><td style="text-align:left;">localTime</td><td style="text-align:left;">返回当前日期和时间</td></tr><tr><td style="text-align:left;">sysDate</td><td style="text-align:left;">返回当前日期和时间</td></tr><tr><td style="text-align:left;">localTimestamp</td><td style="text-align:left;">返回当前日期和时间</td></tr><tr><td style="text-align:left;">unixTimestamp</td><td style="text-align:left;">以 UNIX 时间戳的形式返回当前时间</td></tr><tr><td style="text-align:left;">fromUnixTime</td><td style="text-align:left;">把 UNIX 时间戳的时间转换为普通格式的时间</td></tr><tr><td style="text-align:left;">utcDate</td><td style="text-align:left;">返回 UTC（国际协调时间）日期</td></tr><tr><td style="text-align:left;">utcTime</td><td style="text-align:left;">返回 UTC 时间</td></tr><tr><td style="text-align:left;">month</td><td style="text-align:left;">返回日期 d 中的月份值，范围是 1~12</td></tr><tr><td style="text-align:left;">monthName</td><td style="text-align:left;">返回日期 d 中的月份名称，如 january</td></tr><tr><td style="text-align:left;">dayName</td><td style="text-align:left;">返回日期 d 是星期几，如 Monday</td></tr><tr><td style="text-align:left;">dayOfWeek</td><td style="text-align:left;">返回日期 d 是星期几，1 表示星期日，2 表示星期二</td></tr><tr><td style="text-align:left;">weekday</td><td style="text-align:left;">返回日期 d 是星期几，0 表示星期一，1 表示星期二</td></tr><tr><td style="text-align:left;">week</td><td style="text-align:left;">计算日期 d 是本年的第几个星期，范围是 0-53</td></tr><tr><td style="text-align:left;">weekOfYear</td><td style="text-align:left;">计算日期 d 是本年的第几个星期，范围是 1-53</td></tr><tr><td style="text-align:left;">dayOfYear</td><td style="text-align:left;">计算日期 d 是本年的第几天</td></tr><tr><td style="text-align:left;">dayOfMonth</td><td style="text-align:left;">计算日期 d 是本月的第几天</td></tr><tr><td style="text-align:left;">year</td><td style="text-align:left;">返回日期 d 中的年份值</td></tr><tr><td style="text-align:left;">day</td><td style="text-align:left;">返回日期 d 中的天数值</td></tr><tr><td style="text-align:left;">quarter</td><td style="text-align:left;">返回日期 d 是第几季度，范围 1-4</td></tr><tr><td style="text-align:left;">hour</td><td style="text-align:left;">返回时间 t 中的小时值</td></tr><tr><td style="text-align:left;">minute</td><td style="text-align:left;">返回时间 t 中的分钟值</td></tr><tr><td style="text-align:left;">second</td><td style="text-align:left;">返回时间 t 中的秒钟值</td></tr><tr><td style="text-align:left;">timeToSec</td><td style="text-align:left;">将时间 t 转换为秒</td></tr><tr><td style="text-align:left;">secToTime</td><td style="text-align:left;">将以秒为单位的时间 s 转换为时分秒的格式</td></tr><tr><td style="text-align:left;">toDays</td><td style="text-align:left;">计算日期 d 到 0000 年 1 月 1 日的天数</td></tr><tr><td style="text-align:left;">fromDays</td><td style="text-align:left;">计算从 0000 年 1 月 1 日开始 n 天后的日期</td></tr><tr><td style="text-align:left;">dateDiff</td><td style="text-align:left;">计算日期 d1 到 d2 之间相隔的天数</td></tr><tr><td style="text-align:left;">addDate</td><td style="text-align:left;">计算开始日期 d 加上 n 天的日期</td></tr><tr><td style="text-align:left;">subDate</td><td style="text-align:left;">计算起始日期 d 减去 n 天的日期</td></tr><tr><td style="text-align:left;">addTime</td><td style="text-align:left;">计算起始时间 t 加上 n 秒的时间</td></tr><tr><td style="text-align:left;">subTime</td><td style="text-align:left;">计算起始时间 t 加上 n 秒的时间</td></tr><tr><td style="text-align:left;">dateFormat</td><td style="text-align:left;">按照表达式 f 的要求显示日期 d</td></tr><tr><td style="text-align:left;">timeFormat</td><td style="text-align:left;">按照表达式 f 的要求显示时间 t</td></tr><tr><td style="text-align:left;">getFormat</td><td style="text-align:left;">根据字符串 s 获取 type 类型数据的显示格式</td></tr><tr><td style="text-align:left;">version</td><td style="text-align:left;">返回数据库的版本号</td></tr><tr><td style="text-align:left;">connectionId</td><td style="text-align:left;">返回服务器的连接数</td></tr><tr><td style="text-align:left;">database</td><td style="text-align:left;">返回当前数据库名</td></tr><tr><td style="text-align:left;">schema</td><td style="text-align:left;">返回当前数据库 schema</td></tr><tr><td style="text-align:left;">user</td><td style="text-align:left;">返回当前用户的名称</td></tr><tr><td style="text-align:left;">charset</td><td style="text-align:left;">返回字符串 str 的字符集</td></tr><tr><td style="text-align:left;">collation</td><td style="text-align:left;">返回字符串 str 的字符排列方式</td></tr><tr><td style="text-align:left;">lastInsertId</td><td style="text-align:left;">返回最后生成的 auto_increment 值</td></tr><tr><td style="text-align:left;">password</td><td style="text-align:left;">对字符串 str 进行加密</td></tr><tr><td style="text-align:left;">md5</td><td style="text-align:left;">对字符串 str 进行 md5 加密</td></tr><tr><td style="text-align:left;">encode</td><td style="text-align:left;">使用字符串 pswd_str 来加密字符串 str，加密结果是一个二进制数，必须使用 BLOB 类型来保持它</td></tr><tr><td style="text-align:left;">decode</td><td style="text-align:left;">解密函数，使用字符串 pswd_str 来为 crypt_str 解密</td></tr><tr><td style="text-align:left;">format</td><td style="text-align:left;">格式化函数，可以将数字 x 进行格式化，将 x 保留到小数点后 n 位，这个过程需要进行四舍五入</td></tr><tr><td style="text-align:left;">ascii</td><td style="text-align:left;">返回字符串 s 的第一个字符的 ASSCII 码</td></tr><tr><td style="text-align:left;">bin</td><td style="text-align:left;">返回 x 的二进制编码</td></tr><tr><td style="text-align:left;">hex</td><td style="text-align:left;">返回 x 的十六进制编码</td></tr><tr><td style="text-align:left;">oct</td><td style="text-align:left;">返回 x 的八进制编</td></tr><tr><td style="text-align:left;">conv</td><td style="text-align:left;">将 x 从 f1 进制数变成 f2 进制数</td></tr><tr><td style="text-align:left;">inetAton</td><td style="text-align:left;">将 IP 地址转换为数字表示，IP 值需要加上引号</td></tr><tr><td style="text-align:left;">inetNtoa</td><td style="text-align:left;">将数字 n 转换成 IP 的形式</td></tr></tbody></table><h2 id="select-列计算" tabindex="-1"><a class="header-anchor" href="#select-列计算"><span>select 列计算</span></a></h2><h4 id="示例-1" tabindex="-1"><a class="header-anchor" href="#示例-1"><span>示例 1：</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>    .select(ACCOUNT.ID.add(100).as(&quot;x100&quot;))</span></span>
<span class="line"><span>    .from(ACCOUNT);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>String sql = query.toSQL();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>列计算的 <strong>加减乘除</strong> 对应的方法分别为：add / subtract / multiply / divide</p></blockquote><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT (\`id\` + 100) AS \`x100\` FROM \`tb_account\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="示例-2" tabindex="-1"><a class="header-anchor" href="#示例-2"><span>示例 2：</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>    .select(sum(ACCOUNT.ID.multiply(ACCOUNT.AGE)).as(&quot;total_x&quot;))</span></span>
<span class="line"><span>    .from(ACCOUNT);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT SUM(\`id\` * \`age\`) AS \`total_x\` FROM \`tb_account\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="示例-3" tabindex="-1"><a class="header-anchor" href="#示例-3"><span>示例 3：</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>    .select(ACCOUNT.ID.add(ACCOUNT.AGE.add(100)).as(&quot;x100&quot;))</span></span>
<span class="line"><span>    .from(ACCOUNT);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>String sql = query.toSQL();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT (\`id\` + (\`age\` + 100)) AS \`x100\` FROM \`tb_account\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="select-取相反数" tabindex="-1"><a class="header-anchor" href="#select-取相反数"><span>select 取相反数</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>import static com.mybatisflex.core.query.QueryMethods.*;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    // 负数常量需要手动加括号，不能写成 number(-1)</span></span>
<span class="line"><span>    .select(negative(column(&quot;(-1)&quot;)))</span></span>
<span class="line"><span>    .select(negative(abs(ACCOUNT.AGE)).as(&quot;opp&quot;))</span></span>
<span class="line"><span>    .select(negative(ACCOUNT.ID.add(ACCOUNT.AGE)))</span></span>
<span class="line"><span>    .from(ACCOUNT);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT -(-1), -ABS(\`age\`) AS \`opp\`, -(\`id\` + \`age\`) FROM \`tb_account\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="select-case-when" tabindex="-1"><a class="header-anchor" href="#select-case-when"><span>select case...when</span></a></h2><p><strong>示例 1：</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper wrapper = QueryWrapper.create()</span></span>
<span class="line"><span>        .select(</span></span>
<span class="line"><span>             ACCOUNT.ID</span></span>
<span class="line"><span>            ,case_()</span></span>
<span class="line"><span>                .when(ACCOUNT.ID.ge(2)).then(&quot;x2&quot;)</span></span>
<span class="line"><span>                .when(ACCOUNT.ID.ge(1)).then(&quot;x1&quot;)</span></span>
<span class="line"><span>                .else_(&quot;x100&quot;)</span></span>
<span class="line"><span>                .end().as(&quot;xName&quot;)</span></span>
<span class="line"><span>        )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span> SELECT \`id\`,</span></span>
<span class="line"><span>        (CASE WHEN \`id\` &gt;=  2  THEN &#39;x2&#39;</span></span>
<span class="line"><span>            WHEN \`id\` &gt;=  1  THEN &#39;x1&#39;</span></span>
<span class="line"><span>            ELSE &#39;x100&#39;</span></span>
<span class="line"><span>            END) AS \`xName\`</span></span>
<span class="line"><span> FROM \`tb_account\`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SQL 执行的结果如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>|id     |xName     |</span></span>
<span class="line"><span>|1      |x1        |</span></span>
<span class="line"><span>|2      |x2        |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>示例 2：</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>        .select(</span></span>
<span class="line"><span>                ACCOUNT.ALL_COLUMNS,</span></span>
<span class="line"><span>                case_(ACCOUNT.ID)</span></span>
<span class="line"><span>                    .when(100).then(100)</span></span>
<span class="line"><span>                    .when(200).then(200)</span></span>
<span class="line"><span>                    .else_(300).end().as(&quot;result&quot;)</span></span>
<span class="line"><span>        )</span></span>
<span class="line"><span>        .from(ACCOUNT)</span></span>
<span class="line"><span>        .where(ACCOUNT.USER_NAME.like(&quot;michael&quot;));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT *,</span></span>
<span class="line"><span>       (CASE \`id\`</span></span>
<span class="line"><span>           WHEN 100 THEN 100</span></span>
<span class="line"><span>           WHEN 200 THEN 200</span></span>
<span class="line"><span>           ELSE 300 END) AS \`result\`</span></span>
<span class="line"><span>FROM \`tb_account\`</span></span>
<span class="line"><span>WHERE \`user_name\` LIKE  ?</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>提示</p><p>在以上示例中，由于 <code>case</code> 和 <code>else</code> 属于 Java 关键字，无法使用其进行方法命名，因此会添加一个下划线小尾巴 <code>&quot;_&quot;</code> 变成 <code>case_</code> 和 <code>else_</code>，这是无奈之举。 在以后的 QueryWrapper 构建中，遇到 关键字也会采用类似的解决方法。</p><h2 id="with-select" tabindex="-1"><a class="header-anchor" href="#with-select"><span>with...select</span></a></h2><p>示例 1：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>        .with(&quot;CTE&quot;).asSelect(</span></span>
<span class="line"><span>                select().from(ARTICLE).where(ARTICLE.ID.ge(100))</span></span>
<span class="line"><span>        )</span></span>
<span class="line"><span>        .select()</span></span>
<span class="line"><span>        .from(ACCOUNT)</span></span>
<span class="line"><span>        .where(ACCOUNT.SEX.eq(1));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>System.out.println(query.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成的 SQL 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>WITH CTE AS (SELECT * FROM \`tb_article\` WHERE \`id\` &gt;= 100)</span></span>
<span class="line"><span>SELECT * FROM \`tb_account\` WHERE \`sex\` = 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>示例 2：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>    .with(&quot;xxx&quot;, &quot;id&quot;, &quot;name&quot;).asValues(</span></span>
<span class="line"><span>        Arrays.asList(&quot;a&quot;, &quot;b&quot;),</span></span>
<span class="line"><span>        union(</span></span>
<span class="line"><span>            select().from(ARTICLE).where(ARTICLE.ID.ge(200))</span></span>
<span class="line"><span>        )</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.SEX.eq(1));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>System.out.println(query.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成的 SQL 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>WITH xxx(id, name)</span></span>
<span class="line"><span>    AS (VALUES (a, b) UNION (SELECT * FROM \`tb_article\` WHERE \`id\` &gt;= 200))</span></span>
<span class="line"><span>SELECT * FROM \`tb_account\` WHERE \`sex\` = 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="with-recursive-select" tabindex="-1"><a class="header-anchor" href="#with-recursive-select"><span>with recursive...select</span></a></h2><p>示例 1：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>    .withRecursive(&quot;CTE&quot;).asSelect(</span></span>
<span class="line"><span>        select().from(ARTICLE).where(ARTICLE.ID.ge(100))</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.SEX.eq(1));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>System.out.println(query.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成的 SQL 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>WITH RECURSIVE CTE AS (SELECT * FROM \`tb_article\` WHERE \`id\` &gt;= 100)</span></span>
<span class="line"><span>SELECT * FROM \`tb_account\` WHERE \`sex\` = 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>示例 2：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>    .withRecursive(&quot;CTE&quot;).asSelect(</span></span>
<span class="line"><span>        select().from(ARTICLE).where(ARTICLE.ID.ge(100))</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    .with(&quot;xxx&quot;, &quot;id&quot;, &quot;name&quot;).asValues(</span></span>
<span class="line"><span>        Arrays.asList(&quot;a&quot;, &quot;b&quot;),</span></span>
<span class="line"><span>        union(</span></span>
<span class="line"><span>            select().from(ARTICLE).where(ARTICLE.ID.ge(200))</span></span>
<span class="line"><span>        )</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.SEX.eq(1));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>System.out.println(query.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成的 SQL 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>WITH RECURSIVE</span></span>
<span class="line"><span>     CTE AS (SELECT * FROM \`tb_article\` WHERE \`id\` &gt;= 100),</span></span>
<span class="line"><span>     xxx(id, name) AS (VALUES (a, b)  UNION (SELECT * FROM \`tb_article\` WHERE \`id\` &gt;= 200))</span></span>
<span class="line"><span>SELECT * FROM \`tb_account\` WHERE \`sex\` = 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="where" tabindex="-1"><a class="header-anchor" href="#where"><span>where</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper=QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.ID.ge(100))</span></span>
<span class="line"><span>    .and(ACCOUNT.USER_NAME.like(&quot;michael&quot;));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>WHERE id &gt;=  ?</span></span>
<span class="line"><span>AND user_name LIKE  ?</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="where-动态条件" tabindex="-1"><a class="header-anchor" href="#where-动态条件"><span>where 动态条件</span></a></h2><p>注意</p><p>QueryWrapper条件构建中，若参数为null时默认会被忽略，不会拼接查询条件</p><p><strong>方式1：when()</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>boolean flag = false;</span></span>
<span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select().from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.ID.ge(100).when(flag)) //flag为false，忽略该条件</span></span>
<span class="line"><span>    .and(ACCOUNT.USER_NAME.like(&quot;michael&quot;));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>WHERE user_name LIKE &#39;michael&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>方式2：使用重载方法</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>boolean flag = false;</span></span>
<span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select().from(ACCOUNT)</span></span>
<span class="line"><span>    .and(ACCOUNT.USER_NAME.like(&quot;michael&quot;, flag)); //flag为false，忽略该条件</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对当前条件参数进行判断：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>String name = &quot;&quot;;</span></span>
<span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select().from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.USER_NAME.like(name, StringUtil::isNotBlank)); //name为空字符串，忽略该条件</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>框架提供了工具类<code>If</code>，包含常用的判断方法（如非空、非空集合、非空字符串等），供开发者简化代码：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>String name = &quot;&quot;;</span></span>
<span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select().from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.USER_NAME.like(name, If::hasText)); //name是否有文本</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述代码生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="where-使用-sql-函数" tabindex="-1"><a class="header-anchor" href="#where-使用-sql-函数"><span>where 使用 SQL 函数</span></a></h2><p>你可以通过使用 QueryMethods 类下的函数实现 where 对指定列运算后作为条件进行查询（QueryMethods 位于 mybatisflex.core.query 下）。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper qw = QueryWrapper.create();</span></span>
<span class="line"><span>qw.select(USER.ID,</span></span>
<span class="line"><span>    USER.USER_ALIAS,</span></span>
<span class="line"><span>    USER.PASSWORD,</span></span>
<span class="line"><span>    USER.USER_NAME.as(&quot;userName&quot;))</span></span>
<span class="line"><span>    .where(</span></span>
<span class="line"><span>           QueryMethods.abs(USER.ID).eq(1)</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    .from(USER);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT \`id\`, \`alias\`, \`pwd\`, \`name\` AS \`userName\`</span></span>
<span class="line"><span>FROM \`user\` WHERE ABS(\`id\`) = 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="where-select" tabindex="-1"><a class="header-anchor" href="#where-select"><span>where select</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.ID.ge(</span></span>
<span class="line"><span>        select(ARTICLE.ACCOUNT_ID).from(ARTICLE).where(ARTICLE.ID.ge(100))</span></span>
<span class="line"><span>    ));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>WHERE id &gt;=</span></span>
<span class="line"><span>(SELECT account_id FROM tb_article WHERE id &gt;=  ? )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="where-exists-not-exists" tabindex="-1"><a class="header-anchor" href="#where-exists-not-exists"><span>where exists, not exists</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper=QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.ID.ge(100))</span></span>
<span class="line"><span>    .and(</span></span>
<span class="line"><span>        exists(  // or notExists(...)</span></span>
<span class="line"><span>            selectOne().from(ARTICLE).where(ARTICLE.ID.ge(100))</span></span>
<span class="line"><span>        )</span></span>
<span class="line"><span>    );</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>WHERE id &gt;=  ?</span></span>
<span class="line"><span>AND EXISTS (</span></span>
<span class="line"><span>    SELECT 1 FROM tb_article WHERE id &gt;=  ?</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="and-or" tabindex="-1"><a class="header-anchor" href="#and-or"><span>and (...) or (...)</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper=QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .where(ACCOUNT.ID.ge(100))</span></span>
<span class="line"><span>    .and(ACCOUNT.SEX.eq(1).or(ACCOUNT.SEX.eq(2)))</span></span>
<span class="line"><span>    .or(ACCOUNT.AGE.in(18,19,20).and(ACCOUNT.USER_NAME.like(&quot;michael&quot;)));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>WHERE id &gt;=  ?</span></span>
<span class="line"><span>AND (sex =  ? OR sex =  ? )</span></span>
<span class="line"><span>OR (age IN (?,?,?) AND user_name LIKE ? )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自定义字符串列名" tabindex="-1"><a class="header-anchor" href="#自定义字符串列名"><span>自定义字符串列名</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>// 静态导入 QueryMethods.column 方法</span></span>
<span class="line"><span>QueryColumn a1 = column(&quot;a1&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .where(a1.ge(100))</span></span>
<span class="line"><span>    .and(a1.ne(200))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>WHERE a1 &gt;=  100</span></span>
<span class="line"><span>AND a1 != 200</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上 SQL 的 Java 代码也可以简写为：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .where(column(&quot;a1&quot;).ge(100))</span></span>
<span class="line"><span>    .and(column(&quot;a1&quot;).ne(200))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意，以上代码需要静态导入 QueryMethods.column 方法：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>import static com.mybatisflex.core.query.QueryMethods.*;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="group-by" tabindex="-1"><a class="header-anchor" href="#group-by"><span>group by</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper=QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .groupBy(ACCOUNT.USER_NAME);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>GROUP BY user_name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="having" tabindex="-1"><a class="header-anchor" href="#having"><span>having</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper=QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .groupBy(ACCOUNT.USER_NAME)</span></span>
<span class="line"><span>    .having(ACCOUNT.AGE.between(18,25));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>GROUP BY user_name</span></span>
<span class="line"><span>HAVING age BETWEEN  ? AND ?</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="orderby" tabindex="-1"><a class="header-anchor" href="#orderby"><span>orderBy</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper=QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .orderBy(ACCOUNT.AGE.asc(), ACCOUNT.USER_NAME.desc().nullsLast());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>ORDER BY age ASC, user_name DESC NULLS LAST</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="orderby-动态排序" tabindex="-1"><a class="header-anchor" href="#orderby-动态排序"><span>orderBy 动态排序</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    // 动态条件取值：true 升序 false 降序 null 不排序。</span></span>
<span class="line"><span>    .orderBy(ACCOUNT.ID, true)</span></span>
<span class="line"><span>    .orderBy(ACCOUNT.BIRTHDAY, false)</span></span>
<span class="line"><span>    .orderBy(ACCOUNT.USER_NAME, null);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT *</span></span>
<span class="line"><span>FROM \`tb_account\`</span></span>
<span class="line"><span>ORDER BY \`id\` ASC, \`birthday\` DESC</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="hint" tabindex="-1"><a class="header-anchor" href="#hint"><span>hint</span></a></h2><p>Hint 是数据库厂商（比如 Oracle、MySQL、达梦等）提供的一种 SQL语法，它允许用户在 SQL 语句中插入相关的语法，从而影响 SQL 的执行方式。 它是一种【非常规】的直接影响优化器、指定执行计划的 SQL 优化手段。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper=QueryWrapper.create()</span></span>
<span class="line"><span>    .select().hint(&quot;INDEX_DESC&quot;)</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .orderBy(ACCOUNT.AGE.asc(), ACCOUNT.USER_NAME.desc().nullsLast());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT /*+ INDEX_DESC */  * FROM tb_account</span></span>
<span class="line"><span>ORDER BY age ASC, user_name DESC NULLS LAST</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="join-left-join-inner-join" tabindex="-1"><a class="header-anchor" href="#join-left-join-inner-join"><span>join（left join，inner join...）</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper=QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .leftJoin(ARTICLE).on(ACCOUNT.ID.eq(ARTICLE.ACCOUNT_ID))</span></span>
<span class="line"><span>    .innerJoin(ARTICLE).on(ACCOUNT.ID.eq(ARTICLE.ACCOUNT_ID))</span></span>
<span class="line"><span>    .where(ACCOUNT.AGE.ge(10));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>LEFT JOIN tb_article ON tb_account.id = tb_article.account_id</span></span>
<span class="line"><span>INNER JOIN tb_article ON tb_account.id = tb_article.account_id</span></span>
<span class="line"><span>WHERE tb_account.age &gt;=  ?</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="join-on-多个条件" tabindex="-1"><a class="header-anchor" href="#join-on-多个条件"><span>join on 多个条件</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .leftJoin(ARTICLE).on(</span></span>
<span class="line"><span>        ACCOUNT.ID.eq(ARTICLE.ACCOUNT_ID).and(ACCOUNT.AGE.eq(18))</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    .where(ACCOUNT.AGE.ge(10));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account LEFT JOIN tb_article</span></span>
<span class="line"><span>ON tb_account.id = tb_article.account_id AND tb_account.age =  ?</span></span>
<span class="line"><span>WHERE tb_account.age &gt;=  ?</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="join-select" tabindex="-1"><a class="header-anchor" href="#join-select"><span>join select</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .leftJoin(</span></span>
<span class="line"><span>        select().from(ARTICLE).where(ARTICLE.ID.ge(100))</span></span>
<span class="line"><span>    ).as(&quot;a&quot;).on(</span></span>
<span class="line"><span>        ACCOUNT.ID.eq(raw(&quot;a.id&quot;))</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    .where(ACCOUNT.AGE.ge(10));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM tb_account</span></span>
<span class="line"><span>LEFT JOIN (SELECT * FROM tb_article WHERE id &gt;=  ? ) AS a</span></span>
<span class="line"><span>ON tb_account.id = a.id</span></span>
<span class="line"><span>WHERE tb_account.age &gt;=  ?</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="join-自己" tabindex="-1"><a class="header-anchor" href="#join-自己"><span>join 自己</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>AccountTableDef a1 = ACCOUNT.as(&quot;a1&quot;);</span></span>
<span class="line"><span>AccountTableDef a2 = ACCOUNT.as(&quot;a2&quot;);</span></span>
<span class="line"><span>ArticleTableDef ar = ARTICLE.as(&quot;ar&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>QueryWrapper queryWrapper = new QueryWrapper()</span></span>
<span class="line"><span>    .select(ar.CONTENT, a1.ID, a2.AGE)</span></span>
<span class="line"><span>    .from(ar)</span></span>
<span class="line"><span>    .leftJoin(a1).on(a1.ID.eq(ar.ACCOUNT_ID))</span></span>
<span class="line"><span>    .leftJoin(a2).on(a2.ID.eq(ar.ACCOUNT_ID));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT</span></span>
<span class="line"><span>    \` ar \`.\` content \`,</span></span>
<span class="line"><span>    \` a1 \`.\` id \`,</span></span>
<span class="line"><span>    \` a2 \`.\` age \`</span></span>
<span class="line"><span>FROM</span></span>
<span class="line"><span>    \` tb_article \` AS \` ar \`</span></span>
<span class="line"><span>    LEFT JOIN \` tb_account \` AS \` a1 \` ON \` a1 \`.\` id \` = \` ar \`.\` account_id \`</span></span>
<span class="line"><span>    LEFT JOIN \` tb_account \` AS \` a2 \` ON \` a2 \`.\` id \` = \` ar \`.\` account_id \`</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>若 <code>tb_account</code> 表带有逻辑删除，那么其生成的 SQL 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT</span></span>
<span class="line"><span>    \` ar \`.\` content \`,</span></span>
<span class="line"><span>    \` a1 \`.\` id \`,</span></span>
<span class="line"><span>    \` a2 \`.\` age \`</span></span>
<span class="line"><span>FROM</span></span>
<span class="line"><span>    \` tb_article \` AS \` ar \`</span></span>
<span class="line"><span>    LEFT JOIN \` tb_account \` AS \` a1 \` ON (\` a1 \`.\` id \` = \` ar \`.\` account_id \`)</span></span>
<span class="line"><span>    AND \` a1 \`.\` is_delete \` = 0</span></span>
<span class="line"><span>    LEFT JOIN \` tb_account \` AS \` a2 \` ON (\` a2 \`.\` id \` = \` ar \`.\` account_id \`)</span></span>
<span class="line"><span>    AND \` a2 \`.\` is_delete \` = 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>关于逻辑删除更多文档请参考 <a href="https://mybatis-flex.com/zh/core/logic-delete.html" target="_blank" rel="noopener noreferrer">这里</a>。</p></blockquote><h2 id="union-union-all" tabindex="-1"><a class="header-anchor" href="#union-union-all"><span>union, union all</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = new QueryWrapper()</span></span>
<span class="line"><span>    .select(ACCOUNT.ID)</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .orderBy(ACCOUNT.ID.desc())</span></span>
<span class="line"><span>    .union(select(ARTICLE.ID).from(ARTICLE))</span></span>
<span class="line"><span>    .unionAll(select(ARTICLE.ID).from(ARTICLE));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其查询生成的 Sql 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>(SELECT id FROM tb_account ORDER BY id DESC)</span></span>
<span class="line"><span>UNION (SELECT id FROM tb_article)</span></span>
<span class="line"><span>UNION ALL (SELECT id FROM tb_article)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="limit-offset" tabindex="-1"><a class="header-anchor" href="#limit-offset"><span>limit... offset</span></a></h2><p>提示</p><p>在 &quot;limit... offset&quot; 的示例中，MyBatis-Flex 能够自动识别当前数据库👍，并根据数据库的类型生成不同的 SQL，用户也可以很轻易的通过 DialectFactory 注册（新增或改写）自己的实现方言。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .select()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .orderBy(ACCOUNT.ID.desc())</span></span>
<span class="line"><span>    .limit(10)</span></span>
<span class="line"><span>    .offset(20);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>MySQL 下执行的代码如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM \`tb_account\` ORDER BY \`id\` DESC LIMIT 20, 10</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>PostgreSQL 下执行的代码如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM &quot;tb_account&quot; ORDER BY &quot;id&quot; DESC LIMIT 20 OFFSET 10</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Informix 下执行的代码如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT SKIP 20 FIRST 10 * FROM &quot;tb_account&quot; ORDER BY &quot;id&quot; DESC</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Oracle 下执行的代码如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM (SELECT TEMP_DATAS.*,</span></span>
<span class="line"><span>    ROWNUM RN FROM (</span></span>
<span class="line"><span>        SELECT * FROM &quot;tb_account&quot; ORDER BY &quot;id&quot; DESC)</span></span>
<span class="line"><span>    TEMP_DATAS WHERE  ROWNUM &lt;=30)</span></span>
<span class="line"><span>WHERE RN &gt;20</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Db2 下执行的代码如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM &quot;tb_account&quot; ORDER BY &quot;id&quot; DESC</span></span>
<span class="line"><span>OFFSET 20 ROWS FETCH NEXT 10 ROWS ONLY</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Sybase 下执行的代码如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT TOP 10 START AT 21 * FROM &quot;tb_account&quot; ORDER BY &quot;id&quot; DESC</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Firebird 下执行的代码如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM &quot;tb_account&quot; ORDER BY &quot;id&quot; DESC ROWS 20 TO 30</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="lambda-扩展" tabindex="-1"><a class="header-anchor" href="#lambda-扩展"><span>Lambda 扩展</span></a></h2><p>简单示例：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = QueryWrapper.create();</span></span>
<span class="line"><span>query.where(Account::getId).ge(100)</span></span>
<span class="line"><span>        .and(Account::getUserName).like(&quot;michael&quot;)</span></span>
<span class="line"><span>        .or(Account::getUserName).like(&quot; &quot;, If::hasText);</span></span>
<span class="line"><span>System.out.println(query.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SQL 输入内容如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM  WHERE \`id\` &gt;=  100  AND \`user_name\` LIKE  &#39;%michael%&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>稍微复杂点的示例：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query = QueryWrapper.create()</span></span>
<span class="line"><span>    .from(Article.class)</span></span>
<span class="line"><span>    .leftJoin(Account.class).as(&quot;a&quot;).on(</span></span>
<span class="line"><span>        //无其他特殊条件可简化成：.on(Account::getId, Article::getAccountId)</span></span>
<span class="line"><span>        wrapper -&gt; wrapper.where(Account::getId).eq(Article::getAccountId)</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    .where(Account::getId).ge(100, If::notEmpty)</span></span>
<span class="line"><span>    .and(wrapper -&gt; {</span></span>
<span class="line"><span>        wrapper.where(Account::getId).ge(100)</span></span>
<span class="line"><span>                .or(Account::getAge).gt(200)</span></span>
<span class="line"><span>                .and(Article::getAccountId).eq(200)</span></span>
<span class="line"><span>                .or(wrapper1 -&gt; {</span></span>
<span class="line"><span>                    wrapper1.where(Account::getId).like(&quot;a&quot;);</span></span>
<span class="line"><span>                })</span></span>
<span class="line"><span>        ;</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span>System.out.println(query.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SQL 输入内容如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM \`tb_article\`</span></span>
<span class="line"><span>    LEFT JOIN \`tb_account\` AS \`a\` ON \`a\`.\`id\` = \`tb_article\`.\`account_id\`</span></span>
<span class="line"><span>WHERE \`a\`.\`id\` &gt;=  100  AND</span></span>
<span class="line"><span>      (\`a\`.\`id\` &gt;=  100</span></span>
<span class="line"><span>           OR \`a\`.\`age\` &gt;  200</span></span>
<span class="line"><span>           AND \`tb_article\`.\`account_id\` =  200</span></span>
<span class="line"><span>           OR (\`a\`.\`id\` LIKE  &#39;%a%&#39; )</span></span>
<span class="line"><span>      )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mybatis-plus-兼容-api-v1-7-2" tabindex="-1"><a class="header-anchor" href="#mybatis-plus-兼容-api-v1-7-2"><span>MyBatis-Plus 兼容 API ^ v1.7.2</span></a></h2><p>从 MyBatis-Flex v1.7.2 开始，QueryWrapper 添加了一系列对 MyBatis-Plus 兼容的 API，方便喜欢 MyBatis-Flex 用户从 MyBatis-Plus 迁移到 MyBatis-Flex。</p><p>示例代码如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = new QueryWrapper();</span></span>
<span class="line"><span>queryWrapper.from(&quot;tb_account&quot;)</span></span>
<span class="line"><span>    .eq(&quot;column1&quot;, &quot;value1&quot;)</span></span>
<span class="line"><span>    .ge(Account::getAge, 18)</span></span>
<span class="line"><span>    .or(wrapper -&gt; {</span></span>
<span class="line"><span>        wrapper.eq(&quot;column2&quot;, &quot;value2&quot;)</span></span>
<span class="line"><span>            .ge(Account::getSex, 0);</span></span>
<span class="line"><span>    });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>System.out.println(queryWrapper.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上代码内容，输出的 SQL 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT * FROM \`tb_account\`</span></span>
<span class="line"><span>WHERE column1 = &#39;value1&#39; AND \`age\` &gt;= 18</span></span>
<span class="line"><span>OR (column2 = &#39;value2&#39; AND \`sex\` &gt;= 0)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上的 API 虽然尽量兼容 MyBatis-Plus，但也有所不同，需要用户注意以下几点：</p><p><strong>注意点 1：</strong></p><blockquote><p>对于 <code>eq()</code>、<code>ne()</code>、<code>...</code> 等方法的忽略条件判断，MyBatis-Plus 在第一个参数，而 MyBatis-Flex 在 <strong>最后一个</strong> 参数。例如：</p></blockquote><p>MyBatis-Plus 的写法：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper qw = new QueryWrapper();</span></span>
<span class="line"><span>qw.eq(false, &quot;column1&quot;, 0); // MyBatis-Plus 在第一个参数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>MyBatis-Flex 的写法：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper qw = new QueryWrapper();</span></span>
<span class="line"><span>qw.eq(&quot;column1&quot;, 0, false); // MyBatis-Flex 在最后一个参数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意点 2：</strong></p><blockquote><p>对于 <code>likeLeft</code>、<code>likeRight</code>、 <code>notLikeLeft</code>、<code>notLikeRight</code> 这 4 个方法，MyBatis-Flex 和 MyBatis-Plus 是相反的。</p></blockquote><p>例如：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper qw = new QueryWrapper();</span></span>
<span class="line"><span>qw.likeLeft(&quot;name&quot;, &quot;3&quot;);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>MyBatis-Plus 生成的 where 条件是：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>where name like &#39;%3&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>而 MyBatis-Flex 生成的 where 条件是：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>where name like &#39;3%&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>因此，假设数据表的内容如下：</p><p>shell</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>name</span></span>
<span class="line"><span>————</span></span>
<span class="line"><span>123</span></span>
<span class="line"><span>345</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相同的代码 <code>qw.likeLeft(&quot;name&quot;, &quot;3&quot;)</code>，MyBatis-Flex 匹配到的内容是 <code>345</code>，而 MyBatis-Plus 匹配到的内容是 <code>123</code>。</p><h2 id="entity-转化为-querywrapper" tabindex="-1"><a class="header-anchor" href="#entity-转化为-querywrapper"><span>Entity 转化为 QueryWrapper</span></a></h2><p>QueryWrapper 提供了 <code>create()</code> 方法帮助用户把 entity 转化为 QueryWrapper。</p><p>简单示例：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>Account account = new Account();</span></span>
<span class="line"><span>account.setAge(18);</span></span>
<span class="line"><span>account.setUserName(&quot;michael&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>QueryWrapper qw = QueryWrapper.create(account);</span></span>
<span class="line"><span>System.out.println(qw.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出的 SQL 内容如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT \`id\`, \`user_name\`, \`birthday\`, \`sex\`, \`age\`, \`is_normal\`</span></span>
<span class="line"><span>FROM \`tb_account\`</span></span>
<span class="line"><span>WHERE \`user_name\` = &#39;michael&#39; and \`age\` = 18</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>自定义 Entity 字段的 SQL 操作符示例：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>Account account = new Account();</span></span>
<span class="line"><span>account.setAge(18);</span></span>
<span class="line"><span>account.setUserName(&quot;michael&quot;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>SqlOperators operators = SqlOperators.of()</span></span>
<span class="line"><span>  .set(Account::getUserName, SqlOperator.LIKE)</span></span>
<span class="line"><span>  .set(Account::getAge, SqlOperator.GE);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>QueryWrapper qw = QueryWrapper.create(account, operators);</span></span>
<span class="line"><span>System.out.println(qw.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出的 SQL 内容如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>SELECT \`id\`, \`user_name\`, \`birthday\`, \`sex\`, \`age\`, \`is_normal\`</span></span>
<span class="line"><span>FROM \`tb_account\`</span></span>
<span class="line"><span>WHERE \`user_name\` LIKE &#39;%michael%&#39; AND \`age\` &gt;= 18</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="map-转化为-querywrapper" tabindex="-1"><a class="header-anchor" href="#map-转化为-querywrapper"><span>Map 转化为 QueryWrapper</span></a></h2><p>方法同 <a href="https://mybatis-flex.com/zh/base/querywrapper.html#entity-%E8%BD%AC%E5%8C%96%E4%B8%BA-querywrapper" target="_blank" rel="noopener noreferrer">Entity 转化为 QueryWrapper</a> 类似，只需要把 entity 变量替换为 map 即可。</p><h2 id="querywrapper-序列化" tabindex="-1"><a class="header-anchor" href="#querywrapper-序列化"><span>QueryWrapper 序列化</span></a></h2><p>在 <code>QueryWrapper</code> 中，由于其定义了 <code>循环引用</code> 的一些数据结构，同时，其很多属性都是 <code>private</code> 或者 <code>protected</code> 修饰且没有 <code>getter</code> <code>setter</code> 方法， 这会导致使用一些 json 库在序列化的过程中，出现问题；但这些问题并非 <code>QueryWrapper</code> 的问题，而是序列化框架的问题。</p><p>因此，我们在使用序列化框架时，需要注意其是否支持这些特征，比如在使用 FastJson2 序列化时，需要添加以下配置：</p><p>序列化：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>String json = JSON.toJSONString(queryWrapper</span></span>
<span class="line"><span>        , JSONWriter.Feature.FieldBased // 基于 field，而非 getter 方法</span></span>
<span class="line"><span>        , JSONWriter.Feature.ReferenceDetection);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>反序列化：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper query  = JSON.parseObject(json, QueryWrapper.class</span></span>
<span class="line"><span>, JSONReader.Feature.FieldBased);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Gson</code> 、<code>Jackson</code> 等其他框架需要自行参考其文档添加相关配置；另外，我们更加建议使用专业的序列化工具去进行序列化，而非使用 json，比如使用 <code>JDK Serial</code> 或者 <code>fst</code> 等。 以下是相关的序列化示例代码：</p><p><code>JDK Serial</code> 序列化：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = ...</span></span>
<span class="line"><span>ByteArrayOutputStream bos = new ByteArrayOutputStream();</span></span>
<span class="line"><span>ObjectOutputStream oos = new ObjectOutputStream(bos);</span></span>
<span class="line"><span>oos.writeObject(queryWrapper);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>JDK Serial</code> 反序列化：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>byte[] bytes = ....</span></span>
<span class="line"><span>ByteArrayInputStream bis = new ByteArrayInputStream(bytes);</span></span>
<span class="line"><span>ObjectInputStream ois = new ObjectInputStream(bis);</span></span>
<span class="line"><span>QueryWrapper queryWrapper = (QueryWrapper) ois.readObject();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>fst</code> 序列化 和 反序列化：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>FSTConfiguration fst = FSTConfiguration.createDefaultConfiguration();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//序列化得到 bytes 进行存储或者传输</span></span>
<span class="line"><span>byte[] bytes = fst.asByteArray(wrapper);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>//反序列化得到 QueryWrapper</span></span>
<span class="line"><span>QueryWrapper newWrapper = (QueryWrapper) fst.asObject(bytes);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="querywrapper-克隆" tabindex="-1"><a class="header-anchor" href="#querywrapper-克隆"><span>QueryWrapper 克隆</span></a></h2><p>当我们想对 <code>QueryWrapper</code> 进行改造而不想影响之前构建出来的 <code>QueryWrapper</code> 时，可以使用 <code>clone()</code> 方法，克隆出来一份 <code>QueryWrapper</code> 进行操作，示例：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryWrapper queryWrapper = QueryWrapper.create()</span></span>
<span class="line"><span>    .from(ACCOUNT)</span></span>
<span class="line"><span>    .select(ACCOUNT.DEFAULT_COLUMNS)</span></span>
<span class="line"><span>    .where(ACCOUNT.ID.eq(1));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>QueryWrapper clone = queryWrapper.clone();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 清空 SELECT 语句</span></span>
<span class="line"><span>CPI.setSelectColumns(clone, null);</span></span>
<span class="line"><span>// 重新设置 SELECT 语句</span></span>
<span class="line"><span>clone.select(ACCOUNT.ID, ACCOUNT.USER_NAME);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>System.out.println(queryWrapper.toSQL());</span></span>
<span class="line"><span>System.out.println(clone.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="特别注意事项" tabindex="-1"><a class="header-anchor" href="#特别注意事项"><span>特别注意事项!!!</span></a></h2><p>在 QueryWrapper 的条件构建中，如果传入 null 值，则自动忽略该条件，这有许多的好处，不需要额外的通过 <code>when()</code> 方法判断。但是也带来一些额外的知识记忆点， 因此，正对这一点需要特别注意一下。</p><p>例如：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>String userName = null;</span></span>
<span class="line"><span>Integer id = null;</span></span>
<span class="line"><span>QueryWrapper query1 = QueryWrapper.create()</span></span>
<span class="line"><span>    .where(ACCOUNT.AGE.ge(18))</span></span>
<span class="line"><span>    .and(ACCOUNT.USER_NAME.like(userName))</span></span>
<span class="line"><span>    .and(ACCOUNT.ID.ge(id));</span></span>
<span class="line"><span></span></span>
<span class="line"><span>QueryWrapper query2 = QueryWrapper.create()</span></span>
<span class="line"><span>    .where(ACCOUNT.AGE.ge(18));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在以上的 <code>query1</code> 中，由于 <code>userName</code> 和 <code>id</code> 都为 null，MyBatis-Flex 会自动忽略 null 值的条件，因此，它们构建出来的 SQL 条件是和 <code>query2</code> 完全一致的 。</p><h2 id="querycolumnbehavior-v1-5-7" tabindex="-1"><a class="header-anchor" href="#querycolumnbehavior-v1-5-7"><span>QueryColumnBehavior ^ v1.5.7</span></a></h2><p>在以上的内容中，我们知道 MyBatis-Flex 会自动忽略 <code>null</code> 值的条件，但是在实际开发中，有的开发者希望除了自动忽略 <code>null</code> 值以外，还可以自动忽略其他值，内置的规则有<code>null</code>(默认) 、<code>空字符串</code>、<code>空白字符串</code> ，当然也可以自定义。</p><p>此时，我们可以通过配置 QueryColumnBehavior 来自定义忽略的值。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>// 使用内置规则自动忽略 null 和 空字符串</span></span>
<span class="line"><span>QueryColumnBehavior.setIgnoreFunction(QueryColumnBehavior.IGNORE_EMPTY);</span></span>
<span class="line"><span>// 使用内置规则自动忽略 null 和 空白字符串</span></span>
<span class="line"><span>QueryColumnBehavior.setIgnoreFunction(QueryColumnBehavior.IGNORE_BLANK);</span></span>
<span class="line"><span>// 其他自定义规则</span></span>
<span class="line"><span>QueryColumnBehavior.setIgnoreFunction(o -&gt; {...});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外，在某些场景下，开发者希望在构建 QueryWrapper 中，如果传入的值是集合或数组，则使用 <code>in</code> 逻辑，否则使用 <code>=</code>（等于） 逻辑：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>QueryColumnBehavior.setSmartConvertInToEquals(true);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>当添加以上配置时，我们在构建 QueryWrapper 的 <code>in</code> 的 SQL 时，逻辑如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>// ids 有多个值</span></span>
<span class="line"><span>List&lt;Integer&gt; ids = Arrays.asList(1, 2, 3);</span></span>
<span class="line"><span>QueryWrapper qw = new QueryWrapper();</span></span>
<span class="line"><span>qw.where(ACCOUNT.ID.in(ids))</span></span>
<span class="line"><span></span></span>
<span class="line"><span>System.out.println(qw.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出的 SQL 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>select * from tb_account where id in (1,2,3);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>若 <code>ids</code> 只有 1 个值时，逻辑如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>// ids 只有 1 个值</span></span>
<span class="line"><span>List&lt;Integer&gt; ids = Arrays.asList(1);</span></span>
<span class="line"><span>QueryWrapper qw = new QueryWrapper();</span></span>
<span class="line"><span>qw.where(ACCOUNT.ID.in(ids))</span></span>
<span class="line"><span></span></span>
<span class="line"><span>System.out.println(qw.toSQL());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出的 SQL 如下：</p><p>sql</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>select * from tb_account where id = 1;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="存在疑问" tabindex="-1"><a class="header-anchor" href="#存在疑问"><span>存在疑问？</span></a></h2><p><strong>疑问1：示例代码中的 QueryWrapper 所需要的 &quot;ACCOUNT&quot; 从哪里来的？</strong></p><p>答：MyBatis-Flex 使用了 APT（Annotation Processing Tool）在项目编译的时候， 会自动根据 Entity 类定义的字段生成 &quot;ACCOUNT&quot; 类以及 Entity 对应的 Mapper 类， 通过开发工具构建项目（如下图）， 或者执行 maven 编译命令: <code>mvn clean package</code> 都可以自动生成。这个原理和 lombok 一致。</p><figure><img src="https://mybatis-flex.com/assets/build_idea.53vQKc2W.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>`,326)]))}const p=e(l,[["render",t]]),c=JSON.parse('{"path":"/framework/mybatisflex/base/znmiqwtb/","title":"灵活的QueryWrapper","lang":"zh-CN","frontmatter":{"title":"灵活的QueryWrapper","createTime":"2025/08/26 17:25:24","permalink":"/framework/mybatisflex/base/znmiqwtb/"},"readingTime":{"minutes":19.37,"words":5810},"git":{"createdTime":1756736713000},"filePathRelative":"notes/framework/mybatisflex/base/灵活的QueryWrapper.md","headers":[]}');export{p as comp,c as data};
