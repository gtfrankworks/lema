---
title: MongoDB文档模型设计
createTime: 2025/08/25 14:23:53
permalink: /mongodb/MongoDB文档模型设计/2juizrnj/
---
#### 什么是数据模型？
数据模型就是通过创建一个逻辑化、物理化的模型，来提供一个同一个层面交流的目的。  
---
## 数据模型设计的元素
#### 实体(Entity)
- 描述业务的主要数据集合  
- 谁，什么，何时，何地，为何，如何  

#### 属性(Attribute)
- 描述实体里面的单个信息  

#### 关系(Relationship)
- 描述实体与实体之间的数据规则  
- 解构规则：1-N，N-1，N-N  
- 引用规则  

---

## 数据模型设计基础

<details>
<summary>展开查看：传统模型设计对比</summary>

|            | 模型概念 CDM | 逻辑模型 LDM | 物理模型 PDM |
| ---------- | ------------ | ------------ | ------------ |
| 目的       | 描述业务系统要管理的对象 | 基于概念模型，详细列出所有实体、实体的属性及关系 | 根据逻辑模型，结合数据库的物理结构，设计具体的表结构，字段及主外键 |
| 特点       | 概念名词描述业务，例如"联系人" | 基于业务描述，和数据库无关 | 技术实现细节，和具体数据库类型相关 |
| 使用者     | 需求分析师 | 架构师、开发者 | 开发者、DBA |

> 注意：关系型数据库遵循第三范式，例如联系人地址需将省、市、区单独存储。

</details>

#### MongoDB文档模型设计的三个误区
1. 不需要设计模型  
2. MongoDB 用一个超级大文档组织所有数据  
3. MongoDB 不支持关联或事务  

#### 关于 JSON 文档模型设计
- 文档模型设计处于 **物理模型阶段(PDM)**  
- JSON 文档通过内嵌数组或引用字段表示关系  
- 不遵循第三范式，允许冗余  

#### 为什么说 MongoDB 无模式？
- 概念/逻辑建模依然需要  
- 无模式只是省略物理建模的严格约束  

#### 文档模型设计原则
- **性能 Performance**  
- **开发易用 Ease of Development**  

---

## 关系模型 VS 文档模型

<details>
<summary>展开对比表</summary>

|   | 关系数据库 | JSON文档模型 |
|---|---|---|
| 模型设计层次 | 概念模型、逻辑模型、物理模型 | 概念模型、逻辑模型 |
| 模型实体 | 表 | 集合 |
| 模型属性 | 列 | 字段 |
| 模型关系 | 主外键 | 内嵌数组 / 引用字段 |

</details>

---

## MongoDB文档模型设计三步曲

<details>
<summary>展开查看：三步曲说明</summary>

| 步骤  | 说明 |
| ----- | ------------------------------------------------------------ |
| 第1步 | 逻辑导向：集合、字段、基础形状 |
| 第2步 | 技术导向：引用、关联，优化工况 |
| 第3步 | 模式导向：套用成熟设计模式 |

</details>

---

### 第1步：建立基础文档模型
1. 概念模型 → 逻辑模型 → 找对象  
2. 明确实体关系及基数  
3. 决定内嵌 / 引用方式  
4. 完成基础模型  

> 单文档最大 16MB  

---

### 第2步：根据读写工况细化
- 最常用的查询参数？  
- 最频繁的写入模式？  
- 读写比例？  
- 数据量规模？  

场景优化：  
1. 用 **引用** 避免性能瓶颈  
2. 用 **冗余** 提升查询性能  

**引用适用场景：**  
- 内嵌文档过大（MB 级或 >16MB）  
- 内嵌数组频繁修改  
- 内嵌数组持续增长无上限  

> MongoDB `$lookup` 类似外连接，但无主外键约束，且不支持分片表。  

---

### 第3步：套用设计模式
- 文档模型 = 灵活无范式  
- 设计模式 = 实战经验技巧  

示例：IoT 分桶模式 → 由每分钟存一条 → 改为每小时存一条，减少文档数量和索引开销。  

---

## MongoDB设计模式集锦

| 表现形式类 | 数据访问类 | 组织结构类 |
| ---------- | ---------- | ---------- |
| 列转行     | 子集       | 预聚合     |
| 文档版本   | 近似处理   | 分桶       |

---

### 列转行
场景：大文档字段多、索引多  
方案：把多个国家上映日期拆成数组  

```json
{
  "releases": [
    {"country": "USA", "date": "2020/06/02"},
    {"country": "CN", "date": "2020/06/01"}
  ]
}
