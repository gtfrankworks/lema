---
title: 蚂蚁金服-Java中级
createTime: 2025/08/21 13:19:09
permalink: /bigcompany/1o2qrb8l/
---
- ### 1. **JDK1.7 → JDK1.8 Map 底层变化**

  - **HashMap 数据结构**：
    - **JDK1.7**：数组 + 链表。每个元素存储在数组中的一个“桶”，如果多个 key 的 hash 冲突，就用链表挂在同一个桶上。
    - **JDK1.8**：数组 + 链表 + 红黑树。链表长度 > 8 时，链表转为红黑树，提高查找效率。
  - **原因**：避免哈希冲突严重时链表退化为 O(n) 查找。
  - **并发问题**：
    - JDK1.7/1.8 HashMap 都不线程安全；
    - 并发插入可能出现死循环。
  - **类比**：1.7 像“排队找东西”，1.8 多了“二叉树快通道”，查找快。

  **面试扩展**：

  - HashMap resize 的时候也可能触发链表转换为红黑树。
  - 为什么 8？经验值，链表太短用红黑树反而浪费内存。

  ------

  ### 2. **ConcurrentHashMap**

  - **核心思想**：线程安全、降低锁竞争。
  - **JDK1.7**：
    - 分段锁（Segment）：每段独立锁，锁粒度较粗。
  - **JDK1.8**：
    - CAS + synchronized + 链表/红黑树。
    - 使用 `Node` + `ForwardingNode` + `TreeBin` 实现高并发。
  - **优势**：
    - 多线程可以同时读写不同桶；
    - 避免全表锁，提高性能。
  - **应用场景**：
    - 高并发缓存、统计计数器、线程安全集合。

  ------

  ### 3. **并发 vs 并行**

  | 概念 | 描述           | 类比                 |
  | ---- | -------------- | -------------------- |
  | 并发 | 多任务交替执行 | 一位厨师轮流做几道菜 |
  | 并行 | 多任务同时执行 | 多位厨师同时做不同菜 |

  - **总结**：并发强调“交替调度”，并行强调“同时执行”，多线程不一定并行，单核 CPU 并发，多核 CPU 可并行。

  ------

  ### 4. **JDK1.7 → JDK1.8 JVM 内存变化**

  - **JDK1.7**：
    - 堆：Young（Eden + Survivor）、Old；
    - 方法区：Permanent Generation（存放类元信息、静态变量、字符串常量）。
  - **JDK1.8**：
    - 永久代移除 → MetaSpace（存放类元信息，位于本地内存）。
  - **好处**：
    - 避免 PermGen OutOfMemoryError；
    - MetaSpace 可动态增长；
    - GC 更高效，可回收类卸载。
  - **类比**：PermGen = 固定容量文件柜 → 易满；MetaSpace = 云存储 → 自动扩容。

  ------

  ### 5. **设计中间件**

  1. **RPC（远程调用）**：
     - 屏蔽网络调用细节，像调用本地方法。
     - 需要序列化/反序列化，网络传输。
  2. **消息中间件（MQ）**：
     - 异步通信、队列、发布订阅。
     - 可实现解耦、缓冲高峰流量。
  3. **对象请求代理（ORB / OTM）**：
     - 封装通信协议，统一接口。
     - 支持同步、异步、广播。
  4. **事务处理监控**：
     - 保证 ACID；
     - 进程管理、负载均衡；
     - 分布式事务控制。

  - **类比**：中间件像交通枢纽，协调各个服务、消息、事务高效流动。

  ------

  ### 6. **中间件定义**

  - **概念**：操作系统和应用程序之间的软件，用于通信和集成。
  - **功能**：
    - 消息传递；
    - 远程调用；
    - 对象代理；
    - 事务管理。
  - **分类**：
    - RPC；
    - 消息队列（ActiveMQ、RabbitMQ、Kafka）；
    - 对象请求代理（CORBA）；
    - 事务处理监控（分布式事务协调）。

  ------

  ### 7. **ThreadLocal**

  - **作用**：线程级变量，线程安全。
  - **原理**：
    - 每个线程维护一个 `ThreadLocalMap`；
    - `ThreadLocal.set()` → 当前线程 Map 存值；
    - `ThreadLocal.get()` → 当前线程 Map 取值；
  - **应用**：
    - 事务上下文；
    - 用户会话信息；
    - 数据库连接池（每线程独占）。
  - **类比**：每个线程有自己的储物柜，别人不能碰。

  ------

  ### 8. **hashCode() vs equals() vs ==**

  | 方法         | 比较内容 | 说明                     |
  | ------------ | -------- | ------------------------ |
  | `==`         | 内存地址 | 是否同一对象             |
  | `equals()`   | 对象内容 | 可重写逻辑判断           |
  | `hashCode()` | 散列值   | HashMap/HashSet 判断位置 |

  - **规律**：
    - equals 相等 → hashCode 必然相等；
    - hashCode 相等 → equals 不一定相等；
  - **类比**：hashCode = 快递单号，equals = 快递内容，== = 快递仓库里的实际箱子。

  ------

  ### 9. **MySQL 索引无法使用情况**

  1. OR 条件：部分列有索引也无效；
  2. 多列索引未按最左前缀使用；
  3. LIKE %xxx：开头模糊匹配不使用索引；
  4. 类型转换：列类型与查询类型不一致；
  5. 索引列运算/函数：如 `YEAR(date)`；
  6. 优化器判断全表扫描比索引更快。

  **不推荐索引的字段**：

  - 唯一性差；
  - 频繁更新；
  - 不在 WHERE 条件使用；
  - 使用 `<>` 或 `%` 开头模糊查询。

  ------

  ### 10. **MySQL 分库策略**

  - **垂直分库**：不同业务拆分不同库；
  - **水平分库**：同表数据拆分不同库；
  - **索引优化**：
    - 覆盖索引；
    - 组合索引；
    - 避免冗余索引；
  - **SQL 优化**：
    - 避免 SELECT *；
    - JOIN 优化子查询；
    - 批量操作减少网络往返；
    - 使用 EXPLAIN 分析执行计划。

  ------

  ### 11. **分布式事务解决方案**

  - 两阶段提交（2PC）：先准备 → 再提交；
  - 三阶段提交（3PC）：多一阶段防止阻塞；
  - TCC（Try/Confirm/Cancel）：可补偿事务；
  - 基于消息队列的最终一致性：异步重试机制。

  ------

  ### 12. **SQL 优化技巧**

  - 避免全表扫描；
  - 避免函数/运算影响索引；
  - 使用覆盖索引减少回表；
  - 批量处理减少网络开销；
  - 分页优化（`LIMIT + 索引`）；
  - 复杂查询优化 JOIN 顺序、子查询改为 JOIN。

  ------

  ### 13. **MySQL 存储引擎**

  | 引擎   | 特点                         | 场景               |
  | ------ | ---------------------------- | ------------------ |
  | InnoDB | 支持事务、行锁、聚集索引     | OLTP，高并发写操作 |
  | MyISAM | 不支持事务、表锁、非聚集索引 | OLAP，读多写少     |

  - **聚集索引**：数据和主键一起存储，查询主键快速；
  - **非聚集索引**：索引 + 数据分离，需要回表查数据；
  - **为什么 B+ 树而不是 Hash**：
    - 支持范围查询；
    - 顺序存储，提高磁盘 IO 连续性；
    - Hash 只适合等值查询，不支持范围。

  ------

  ### 14. **红黑树原理**

  - **规则**：
    1. 节点红/黑；
    2. 根黑；
    3. 红节点不能连续；
    4. 任意路径黑节点数相同；
  - **特点**：
    - 保证 O(log n) 查找、插入、删除；
    - HashMap 长链表 > 8 转红黑树。
  - **类比**：像书架，每层书数均衡，查书快。

